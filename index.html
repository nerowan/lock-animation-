<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>京杭大运河 - 动画 & 问答游戏（UI优化版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ==================== 全局样式与重置 ==================== */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden; /* 固定全屏 */
      font-family: "Microsoft YaHei", sans-serif;
      background: #b3d9ff;
      /* 使用相对单位，让文字更易随屏幕变动 */
      font-size: 16px;
    }

    /* 让 rem 更好适配：一般默认html font-size=16px，即1rem=16px */
    /* 后续在 @media 查询中可调整根字体大小 */

    /* 用于切换页面显示与隐藏 */
    .hidden {
      display: none !important;
    }

    /* ==================== 主容器 ==================== */
    #app {
      width: 100%;
      height: 100%;
      position: relative;
    }

    /* ==================== 主菜单 ==================== */
    #mainMenu {
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, #4fc3f7, #81d4fa);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 2rem;
    }
    #mainMenu h1 {
      font-size: 1.5rem; /* 初始笔记本端 */
      color: #fff;
      margin-bottom: 2rem;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      text-align: center;
    }
    .menu-btn {
      width: 12rem;
      padding: 0.75rem;
      margin: 0.5rem;
      font-size: 1rem;
      color: #fff;
      background: #0288d1;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background 0.3s;
      text-align: center;
      box-shadow: 0 0.2rem 0.6rem rgba(0,0,0,0.2);
    }
    .menu-btn:hover {
      background: #0277bd;
    }
    /* 神秘小游戏按钮，固定在右下角 */
    #mysteryGameBtn {
      position: absolute;
      bottom: 1.5rem;
      right: 1.5rem;
      padding: 0.75rem 1rem;
      background: #e91e63;
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      box-shadow: 0 0.2rem 0.6rem rgba(0,0,0,0.2);
      transition: background 0.3s;
      font-size: 0.9rem;
    }
    #mysteryGameBtn:hover {
      background: #d81b60;
    }

    /* ==================== 动画页面容器 ==================== */
    #animationPage {
      width: 100%;
      height: 100%;
      position: absolute;
      top:0;
      left:0;
      background: #b3d9ff;
    }
    /* 返回主菜单按钮 */
    .backToMenuBtn {
      position: absolute;
      top: 1rem;
      left: 1rem;
      padding: 0.5rem 0.8rem;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 0.2rem 0.6rem rgba(0,0,0,0.3);
      transition: background 0.3s;
      font-size: 0.9rem;
    }
    .backToMenuBtn:hover {
      background: #d32f2f;
    }

    /* ==================== 问答游戏页面 ==================== */
    #quizPage {
      width: 100%;
      height: 100%;
      background: #eceff1;
      position: absolute;
      top:0;
      left:0;
      display: flex;
      flex-direction: column;
    }
    .quiz-header {
      background: #0288d1;
      color: #fff;
      padding: 1rem;
      text-align: center;
      position: relative;
    }
    .quiz-header h2 {
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }
    .quiz-header .backToMenuBtn {
      top: 0.7rem;
      left: 0.7rem;
    }
    .quiz-container {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    .quiz-question {
      margin-bottom: 1rem;
      padding: 1rem;
      background: #fff;
      border-radius: 0.5rem;
      box-shadow: 0 0.2rem 0.4rem rgba(0,0,0,0.1);
    }
    .quiz-question h3 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .quiz-question .option {
      margin: 0.3rem 0;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .quiz-submit-btn {
      width: 8rem;
      padding: 0.5rem;
      margin: 1rem auto;
      display: block;
      background: #00796b;
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      text-align: center;
      transition: background 0.3s;
    }
    .quiz-submit-btn:hover {
      background: #004d40;
    }
    .quiz-result {
      text-align: center;
      margin-top: 0.5rem;
      font-size: 1rem;
      color: #333;
    }
    /* 排行榜 */
    .leaderboard {
      margin-top: 1rem;
      text-align: center;
      color: #555;
      font-size: 0.9rem;
    }

    /* ==================== 响应式适配 ==================== */
    /* 针对平板或中屏(<=900px)做轻量缩放 */
    @media (max-width: 900px) {
      html {
        font-size: 15px; 
      }
      #mainMenu h1 {
        font-size: 1.4rem;
        margin-bottom: 1.5rem;
      }
      .menu-btn {
        width: 10rem;
        font-size: 0.95rem;
      }
    }
    /* 针对手机或小屏(<=600px) */
    @media (max-width: 600px) {
      html {
        font-size: 14px; /* 整体稍微再缩小一点，但不至于过小 */
      }
      #mainMenu h1 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
      }
      .menu-btn {
        width: 9rem;
        font-size: 0.85rem;
        margin: 0.4rem;
      }
      #mysteryGameBtn {
        bottom: 1rem;
        right: 1rem;
        font-size: 0.8rem;
        padding: 0.5rem 0.8rem;
      }
      .backToMenuBtn {
        font-size: 0.8rem;
        top: 0.5rem;
        left: 0.5rem;
      }
      .quiz-header h2 {
        font-size: 1rem;
      }
      .quiz-question h3 {
        font-size: 0.9rem;
      }
      .quiz-submit-btn {
        width: 7rem;
        font-size: 0.85rem;
      }
    }

    /* ==================== 动画内容(6大场景 + 场景4游戏) ==================== */
    #animationContainer {
      width: 100%;
      height: 100%;
      position: relative;
      perspective: 1000px; 
    }

    /* 场景基础 */
    .scene {
      position: absolute;
      top:0; 
      left:0;
      width: 100%;
      height: 100%;
      display: none;
      overflow: hidden;
    }
    .active {
      display: block;
    }

    .fade-in {
      animation: fadeIn 1.5s forwards ease;
    }
    .fade-out {
      animation: fadeOut 1.5s forwards ease;
    }
    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes fadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* 云朵漂移 */
    .cloud {
      position: absolute;
      width: 12rem;
      height: 6rem;
      background: #fff;
      border-radius: 6rem;
      box-shadow: 60px 30px 0 20px #fff, 90px 40px 0 10px #fff;
      opacity: 0.8;
      animation: cloudMove 30s linear infinite;
    }
    @keyframes cloudMove {
      0% { transform: translateX(-300px); }
      100% { transform: translateX(1300px); }
    }

    /* 水面与波浪 */
    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to top, #0277bd 0%, #4fc3f7 100%);
      overflow: hidden;
    }
    .wave {
      position: absolute;
      width: 125rem; /* 2000px相当于125rem(如1rem=16px) */
      height: 12.5rem;
      top: -6rem;
      left: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      animation: waveAnimation 6s infinite linear;
      opacity: 0.8;
    }
    .wave:nth-child(2) {
      animation-delay: -2s;
      opacity: 0.5;
    }
    @keyframes waveAnimation {
      0% { transform: translateX(0); }
      100% { transform: translateX(-62.5rem); }
    }

    /* 小船 */
    .boat {
      position: absolute;
      width: 7.5rem;  /* 120px approx = 7.5rem */
      height: 3.75rem;/* 60px approx = 3.75rem */
      left: 10%;
      bottom: 20%;
      background-color: #8d6e63; 
      border-radius: 0 0 5rem 5rem;
      animation: boatFloat 3s ease-in-out infinite;
      box-shadow: 0 0.3rem 0.6rem rgba(0,0,0,0.3);
    }
    .boat::before {
      content: "";
      position: absolute;
      width: 3.75rem; /* 60px => 3.75rem */
      height: 3.75rem;
      right: 0.6rem;
      bottom: 1.875rem;
      background-color: #ffca28;
      transform-origin: bottom right;
      transform: skew(-10deg, 0);
    }
    @keyframes boatFloat {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(1deg); }
    }

    /* 公共卡片/文字排版 */
    .card {
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(4px);
      box-shadow: 0 0.25rem 1.25rem rgba(0,0,0,0.2);
      border-radius: 0.75rem;
      padding: 1rem;
      position: relative;
      max-width: 80%;
      margin: 0 auto;
    }

    /* “进入下一部分”按钮 */
    .next-part-btn {
      position: absolute;
      bottom: 1.25rem;
      right: 1.25rem;
      padding: 0.6rem 1rem;
      background: #8bc34a;
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      box-shadow: 0 0.2rem 0.8rem rgba(0,0,0,0.2);
      transition: background 0.3s;
      font-size: 0.9rem;
      z-index: 998;
    }
    .next-part-btn:hover {
      background: #7cb342;
    }

    /* 场景1 样式 */
    #scene1 .title {
      position: absolute;
      top: 15%;
      left: 10%;
      width: 80%;
      animation: floatText 3s infinite;
      text-align: left;
    }
    @keyframes floatText {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* 场景2 3D翻转卡片等 */
    #scene2 .diagram-container {
      position: absolute;
      top: 15%;
      right: 10%;
      width: 18.75rem; /* 300px ~ 18.75rem */
      height: 20rem;   /* 320px ~ 20rem */
      perspective: 1000px;
    }
    .diagram-card {
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      animation: cardFlip 8s linear infinite;
      position: relative;
    }
    @keyframes cardFlip {
      0%   { transform: rotateY(0); }
      25%  { transform: rotateY(180deg); }
      50%  { transform: rotateY(180deg); }
      75%  { transform: rotateY(360deg); }
      100% { transform: rotateY(360deg); }
    }
    .diagram-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 0.5rem;
    }
    .diagram-front {
      background: #fffae6;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      text-align: center;
      padding: 1rem;
    }
    .diagram-back {
      background: #fff5e1;
      transform: rotateY(180deg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      text-align: center;
      padding: 1rem;
    }

    /* 场景3 水闸类型卡片 */
    #scene3 .gate-types {
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 70%;
      padding: 1rem;
      display: flex;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 0.75rem;
    }
    .gate-item {
      flex: 1;
      margin: 0.5rem;
      border: 2px solid #90caf9;
      border-radius: 0.5rem;
      background: rgba(255,255,255,0.7);
      padding: 0.5rem;
      animation: gateItemFloat 5s infinite ease-in-out;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    }
    @keyframes gateItemFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .gate-item h4 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: #333;
    }
    .gate-item p {
      font-size: 0.85rem;
      line-height: 1.4;
      color: #444;
      text-align: center;
    }

    /* 场景4：水闸小游戏 */
    #scene4 .lock-system {
      position: absolute;
      top: 10%;
      left: 5%;
      width: 90%;
      height: 75%;
      border-radius: 0.5rem;
      overflow: hidden;
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.7);
      box-shadow: 0 0.3rem 1rem rgba(0,0,0,0.2);
      display: flex;
      flex-direction: row;
    }
    /* 左侧操作面板 */
    .sidebar-game {
      width: 15rem;
      min-width: 12rem;
      background-color: rgba(255,255,255,0.9);
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      margin-right: 1rem;
      padding: 0.5rem;
      overflow-y: auto;
    }
    .sidebar-game h3 {
      text-align: center;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    .sidebar-game p {
      margin: 0.3rem 0;
      font-size: 0.85rem;
      line-height: 1.4;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin: 0.5rem 0;
    }
    .btn-group button {
      flex: 1 1 auto;
      padding: 0.4rem;
      margin: 0.2rem;
      border: none;
      border-radius: 0.4rem;
      background: #42a5f5;
      color: #fff;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .btn-group button:hover {
      background: #1e88e5;
      transform: scale(1.03);
    }
    #resetGame {
      background: #f44336;
    }
    #resetGame:hover {
      background: #d32f2f;
    }
    /* 右侧可视区域 */
    .lock-visual {
      flex: 1;
      position: relative;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      margin: 0 auto;
      overflow: hidden;
    }
    .chamber {
      position: absolute;
      width: 80%;
      height: 60%;
      top: 20%;
      left: 10%;
      background-color: #bbdefb;
      border: 2px solid #0d47a1;
      border-radius: 0.3rem;
      overflow: hidden;
      box-shadow: inset 0 0 0.6rem rgba(0,0,0,0.1);
    }
    .chamber-water {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80%;
      background: linear-gradient(to top, #4fc3f7 0%, #b3e5fc 100%);
      transition: height 1.5s ease;
    }
    .gate {
      position: absolute;
      bottom: 0;
      width: 5%;
      height: 100%;
      background-color: #546e7a;
      transition: transform 1s ease;
      z-index: 2;
    }
    .gate-left { left: 0; }
    .gate-right { right: 0; }
    .open-left { transform: translateX(-100%); }
    .open-right { transform: translateX(100%); }

    .lock-boat {
      position: absolute;
      bottom: 10%;
      width: 5rem; 
      height: 2.5rem;
      background-color: #8d6e63;
      border-radius: 2.5rem 2.5rem 0 0;
      left: -8%;
      transition: left 1.5s ease, bottom 1.5s ease;
      box-shadow: 0 0.2rem 0.5rem rgba(0,0,0,0.3);
    }
    /* 阀门 */
    .valve {
      position: absolute;
      width: 1.5rem;
      height: 1.5rem;
      border: 2px solid #fff;
      border-radius: 50%;
      background-color: red; /* 关闭状态 */
      cursor: pointer;
      box-shadow: 0 0 0.4rem rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }
    .valve.open { background-color: #2ecc71; }
    .valve-top {
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
    }
    .valve-bottom {
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
    }

    .status-bar {
      margin-top: 0.5rem;
      padding: 0.3rem;
      background: rgba(0,0,0,0.3);
      color: #fff;
      border-radius: 0.3rem;
      font-size: 0.8rem;
    }
    .status-bar span {
      margin-right: 0.5rem;
    }
    /* “游戏说明”按钮和弹窗 */
    #btnShowGameHelp {
      width: 100%;
      margin-top: 0.4rem;
      background: #9c27b0;
    }
    #btnShowGameHelp:hover {
      background: #7b1fa2;
    }
    .help-overlay {
      position: absolute;
      top: 2rem;
      left: 1rem;
      right: 1rem;
      bottom: 1rem;
      background: rgba(255,255,255,0.9);
      border: 2px solid #ccc;
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-y: auto;
      display: none; /* 初始隐藏 */
      z-index: 999;
    }
    .help-overlay h4 {
      margin-bottom: 0.5rem;
      color: #333;
      font-size: 1rem;
    }
    .help-overlay p {
      margin-bottom: 0.5rem;
      color: #555;
      line-height: 1.4;
      font-size: 0.9rem;
    }
    .help-overlay button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.4rem 0.6rem;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 0.4rem;
      cursor: pointer;
    }

    /* 场景5：运河意义 */
    #scene5 .scenery {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(to top, #b2ebf2, #80deea);
    }
    #scene5 .scenery::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 40%;
      bottom: 0;
      background: linear-gradient(to top, #0277bd 0%, #4fc3f7 100%);
    }
    #scene5 .text-box {
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      border-radius: 0.5rem;
      padding: 1rem;
      animation: contentFloat 3s infinite ease-in-out;
      box-shadow: 0 0.25rem 0.9rem rgba(0,0,0,0.2);
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(4px);
      font-size: 0.9rem;
    }
    @keyframes contentFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .town-boat {
      position: absolute;
      bottom: 20%;
      left: -10%;
      width: 7.5rem;
      height: 3.75rem;
      background-color: #8d6e63;
      border-radius: 0 0 5rem 5rem;
      animation: townBoatMove 10s linear infinite;
      box-shadow: 0 0.3rem 0.6rem rgba(0,0,0,0.2);
    }
    @keyframes townBoatMove {
      0% { left: -10%; }
      100% { left: 110%; }
    }
    .town-building {
      position: absolute;
      bottom: 40%;
      left: 15%;
      width: 9.375rem; /* 150px=9.375rem */
      height: 9.375rem;
      background-color: #ffcc80;
      border: 2px solid #ffb74d;
      border-radius: 0.5rem;
      animation: buildingPulse 6s infinite alternate;
      box-shadow: 0 0.2rem 0.6rem rgba(0,0,0,0.1);
    }
    @keyframes buildingPulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.02); }
    }

    /* 场景6：结尾 */
    #scene6 .final-view {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(to bottom, #ffd54f, #fff9c4);
    }
    #scene6 .final-text {
      position: absolute;
      top: 20%;
      left: 10%;
      width: 80%;
      font-size: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      animation: finalTextShake 3s infinite ease-in-out;
      background-color: rgba(255,255,255,0.8);
      backdrop-filter: blur(3px);
      box-shadow: 0 0.25rem 1.25rem rgba(0,0,0,0.2);
    }
    @keyframes finalTextShake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(1px, -2px); }
      50% { transform: translate(-2px, 2px); }
      75% { transform: translate(2px, -1px); }
    }
    .final-pan {
      position: absolute;
      bottom: 0;
      left: -50%;
      width: 200%;
      height: 100%;
      background: url('https://via.placeholder.com/1600x600/91C483/ffffff?text=京杭大运河全景（示例）') no-repeat center;
      background-size: cover;
      animation: finalPanMove 30s linear infinite;
      opacity: 0.7;
    }
    @keyframes finalPanMove {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-50%); }
    }
  </style>
</head>
<body>
<div id="app">
  <!-- ========== 主菜单 ========== -->
  <div id="mainMenu">
    <h1>京杭大运河 - 动画 & 问答游戏</h1>
    <button class="menu-btn" id="btnGoAnimation">进入动画</button>
    <button class="menu-btn" id="btnGoQuiz">问答游戏</button>
    <!-- 神秘小游戏按钮(右下角) -->
    <button id="mysteryGameBtn" onclick="location.href='game.html'">神秘小游戏</button>
  </div>

  <!-- ========== 动画页面 ========== -->
  <div id="animationPage" class="hidden">
    <button class="backToMenuBtn" id="btnBackMenuFromAnimation">返回主菜单</button>

    <div id="animationContainer">
      <!-- (以下场景与逻辑同之前示例，只是样式已优化) -->

      <!-- 场景1 -->
      <div id="scene1" class="scene">
        <!-- 云朵 -->
        <div class="cloud" style="top:10%; left:15%;"></div>
        <div class="cloud" style="top:20%; left:40%; animation-delay:-15s;"></div>
        <!-- 水面 -->
        <div class="water">
          <div class="wave"></div>
          <div class="wave"></div>
        </div>
        <!-- 小船 -->
        <div class="boat"></div>
        <!-- 文字卡片 -->
        <div class="title card fade-in">
          <h2>欢迎来到“探秘京杭大运河”解说短片</h2>
          <p>
            今天我们将一起了解在京杭大运河中一个非常重要的水利设施——水闸。
            它就像一扇‘水门’，帮助船只在不同水位之间顺利通过，还能调节水流，
            保护沿河地区的安全。
          </p>
        </div>
        <!-- “进入下一部分”按钮 -->
        <button class="next-part-btn" id="scene1NextBtn">进入下一部分</button>
      </div>

      <!-- 场景2：水闸的基本概念 -->
      <div id="scene2" class="scene">
        <!-- 云朵 -->
        <div class="cloud" style="top:15%; left:20%;"></div>
        <div class="cloud" style="top:25%; left:50%; animation-delay:-10s;"></div>
        <!-- 水面 -->
        <div class="water">
          <div class="wave"></div>
          <div class="wave"></div>
        </div>
        <!-- 小船(示意) -->
        <div class="boat" style="animation: boatFloat 2s infinite; bottom:25%;"></div>

        <div class="diagram-container fade-in">
          <div class="diagram-card">
            <!-- 正面 -->
            <div class="diagram-face diagram-front">
              <h4>水闸结构示意(正面)</h4>
              <p>闸室、闸门、水位线等关键部件</p>
            </div>
            <!-- 背面 -->
            <div class="diagram-face diagram-back">
              <h4>水闸功能(背面)</h4>
              <p style="margin: 0 20px; text-align:center;">
                用于控制水位和水流，分洪防汛，  
                帮助船只克服上下游水位差
              </p>
            </div>
          </div>
        </div>

        <div style="
          position:absolute;
          bottom:10%;
          left:10%;
          right:10%;
          background-color: rgba(255,255,255,0.8);
          color: #333;
          padding: 0.5rem;
          border-radius: 0.5rem;
        ">
          <h3 style="font-size:1rem;">什么是水闸？</h3>
          <p style="font-size:0.9rem;">
            水闸是一种用来控制水位和水流的水工建筑。它通常由闸门、闸室和控制系统组成。
            其功能包括帮助船只克服上下游水位差，调节水流量，以及在汛期分洪或防止洪水。
          </p>
        </div>
        <button class="next-part-btn" id="scene2NextBtn">进入下一部分</button>
      </div>

      <!-- 场景3：水闸的类型 -->
      <div id="scene3" class="scene">
        <!-- 云朵 -->
        <div class="cloud" style="top:5%; left:30%;"></div>
        <div class="cloud" style="top:25%; left:60%; animation-delay:-10s;"></div>
        <!-- 水面 -->
        <div class="water">
          <div class="wave"></div>
          <div class="wave"></div>
        </div>
        <!-- 小船在底部 -->
        <div class="boat" style="left:5%; bottom:15%;"></div>

        <div class="gate-types fade-in">
          <div class="gate-item">
            <h4>船闸</h4>
            <p>
              用于帮助船只在高低水位之间安全通行。
              通过闸门和闸室水位的逐步变化，让船平稳通过。
            </p>
          </div>
          <div class="gate-item">
            <h4>节制闸</h4>
            <p>
              主要作用是调节水量，类似“水龙头”，
              在旱季储水，汛期时防止洪水泛滥。
            </p>
          </div>
          <div class="gate-item">
            <h4>分洪闸</h4>
            <p>
              当雨水过多导致水位暴涨时，分洪闸将多余的水引入分洪道，
              有效减轻下游洪水威胁。
            </p>
          </div>
        </div>
        <button class="next-part-btn" id="scene3NextBtn">进入下一部分</button>
      </div>

      <!-- 场景4：水闸运作方式 + 交互式小游戏 -->
      <div id="scene4" class="scene">
        <!-- 云 -->
        <div class="cloud" style="top:10%; left:10%;"></div>
        <div class="cloud" style="top:30%; left:50%; animation-delay:-10s;"></div>
        <!-- 水面 -->
        <div class="water">
          <div class="wave"></div>
          <div class="wave"></div>
        </div>

        <div class="lock-system fade-in">
          <!-- 左侧操作面板 -->
          <div class="sidebar-game">
            <h3>水闸操作小游戏</h3>
            <p>请按正确顺序操作阀门与闸门，让船只从左到右顺利通过。</p>
            <p>若操作错误，会提示失败，需要重新开始。</p>
            
            <div class="btn-group">
              <button id="openTopValve">开启上阀</button>
              <button id="closeTopValve">关闭上阀</button>
            </div>
            <div class="btn-group">
              <button id="openLeftGate">打开上闸门</button>
              <button id="closeLeftGate">关闭上闸门</button>
            </div>
            <div class="btn-group">
              <button id="openBottomValve">开启下阀</button>
              <button id="closeBottomValve">关闭下阀</button>
            </div>
            <div class="btn-group">
              <button id="openRightGate">打开下闸门</button>
              <button id="closeRightGate">关闭下闸门</button>
            </div>
            <hr/>
            <button id="btnShowGameHelp">游戏说明</button>
            <button id="resetGame">重新开始</button>
            <div class="status-bar">
              <span>时间：<span id="timerText">0</span>s</span>
              <span>操作：<span id="stepsText">0</span></span>
              <span id="gameStatus">等待操作</span>
            </div>
          </div>

          <!-- 游戏可视区域 -->
          <div class="lock-visual">
            <div class="chamber" id="chamber">
              <div class="chamber-water" id="chamberWater"></div>
              <div class="gate gate-left" id="gateLeft"></div>
              <div class="gate gate-right" id="gateRight"></div>
              <div class="lock-boat" id="lockBoat"></div>
              <div class="valve valve-top" id="valveTop" title="上排水阀"></div>
              <div class="valve valve-bottom" id="valveBottom" title="下排水阀"></div>
            </div>
            <!-- 游戏说明弹窗 -->
            <div class="help-overlay" id="gameHelpOverlay">
              <button id="btnCloseHelp">X</button>
              <h4>水闸操作说明</h4>
              <p>
                1. 开启上排水阀，让闸室水位降到与下游持平（约40%）。
                <br/>2. 打开上闸门，让船进闸室，然后关闭上闸门。
                <br/>3. 开启下排水阀，让闸室水位上升到上游水平（80%）。
                <br/>4. 关闭下排水阀后，打开下闸门，让船驶出。
                <br/>只要顺序正确，船就能顺利通行。
              </p>
              <p>
                若任何步骤出错，会提示失败，需要点“重新开始”再来。
                <br/>快来体验古代智慧与现代科技的结合吧！
              </p>
            </div>
          </div>
        </div>
        <!-- “进入下一部分”按钮 -->
        <button class="next-part-btn" id="scene4NextBtn">进入下一部分</button>
      </div>

      <!-- 场景5：京杭大运河的意义 -->
      <div id="scene5" class="scene">
        <div class="scenery">
          <div class="text-box fade-in">
            <h3 style="font-size:1rem;">京杭大运河的意义</h3>
            <p style="font-size:0.9rem;">
              京杭大运河是世界上最长的人工河，始建于两千多年前。
              不仅是古代中国南北交通的重要枢纽，也是现代水利工程的典范。
              水闸的运用让大运河水路更加安全便利，并为沿岸城市的发展提供了强大助力。
            </p>
          </div>
          <div class="town-boat"></div>
          <div class="town-building"></div>
        </div>
        <button class="next-part-btn" id="scene5NextBtn">进入下一部分</button>
      </div>

      <!-- 场景6：结尾 -->
      <div id="scene6" class="scene">
        <div class="final-view fade-in">
          <div class="final-pan"></div>
          <div class="final-text">
            <p style="font-size:1rem;">
              “通过了解京杭大运河内水闸的类型和原理，
              我们看到了古代智慧与现代科技的结合。
              希望大家在下一次参观大运河时，能更加了解这条伟大的水路，
              一起守护大运河的未来！”
            </p>
            <p style="margin-top:1rem; text-align:right; font-weight:bold; font-size:1rem;">—— 感谢观看！</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 问答游戏页面 ========== -->
  <div id="quizPage" class="hidden">
    <div class="quiz-header">
      <button class="backToMenuBtn" id="btnBackMenuFromQuiz">返回</button>
      <h2>大运河水闸知识 - 问答游戏</h2>
      <p>测试一下你对水闸和大运河的了解程度吧！</p>
    </div>
    <div class="quiz-container" id="quizContainer">
      <!-- 示例题1 -->
      <div class="quiz-question" data-answer="1">
        <h3>1. 大运河主要功能不包括以下哪项？</h3>
        <label class="option"><input type="radio" name="q1" value="1"> 火箭、飞行器发射</label><br/>
        <label class="option"><input type="radio" name="q1" value="2"> 运输货物与人员</label><br/>
        <label class="option"><input type="radio" name="q1" value="3"> 分洪防汛</label><br/>
        <label class="option"><input type="radio" name="q1" value="4"> 调节水位</label>
      </div>
      <!-- 示例题2 -->
      <div class="quiz-question" data-answer="2">
        <h3>2. 哪种水闸主要用于帮助船舶通过？</h3>
        <label class="option"><input type="radio" name="q2" value="1"> 节制闸</label><br/>
        <label class="option"><input type="radio" name="q2" value="2"> 船闸</label><br/>
        <label class="option"><input type="radio" name="q2" value="3"> 分洪闸</label><br/>
        <label class="option"><input type="radio" name="q2" value="4"> 潮汐闸</label>
      </div>
      <!-- 示例题3 -->
      <div class="quiz-question" data-answer="3">
        <h3>3. 当需要让闸室水位与下游持平时，应先开启？</h3>
        <label class="option"><input type="radio" name="q3" value="1"> 下闸门</label><br/>
        <label class="option"><input type="radio" name="q3" value="2"> 上排水阀</label><br/>
        <label class="option"><input type="radio" name="q3" value="3"> 下排水阀</label><br/>
        <label class="option"><input type="radio" name="q3" value="4"> 不需要开启阀门</label>
      </div>
      
      <button class="quiz-submit-btn" id="quizSubmitBtn">提交答案</button>
      <div class="quiz-result" id="quizResult"></div>
      <!-- 排行榜区域 -->
      <div class="leaderboard" id="leaderboardArea"></div>
    </div>
  </div>
</div>

<script>
  /*
    JS逻辑与之前相同，保留“进入下一部分”按钮功能、自动场景切换、水闸小游戏逻辑、问答排行榜
    不再省略任何逻辑。
  */
  const mainMenu = document.getElementById('mainMenu');
  const animationPage = document.getElementById('animationPage');
  const quizPage = document.getElementById('quizPage');

  const btnGoAnimation = document.getElementById('btnGoAnimation');
  const btnGoQuiz = document.getElementById('btnGoQuiz');
  const btnBackMenuFromAnimation = document.getElementById('btnBackMenuFromAnimation');
  const btnBackMenuFromQuiz = document.getElementById('btnBackMenuFromQuiz');

  // 问答
  const quizSubmitBtn = document.getElementById('quizSubmitBtn');
  const quizResult = document.getElementById('quizResult');
  const leaderboardArea = document.getElementById('leaderboardArea');

  // 场景
  const scenes = [
    document.getElementById('scene1'),
    document.getElementById('scene2'),
    document.getElementById('scene3'),
    document.getElementById('scene4'),
    document.getElementById('scene5'),
    document.getElementById('scene6'),
  ];
  let currentSceneIndex = 0;
  let sceneTimers = [];

  // next-part按钮
  const scene1NextBtn = document.getElementById('scene1NextBtn');
  const scene2NextBtn = document.getElementById('scene2NextBtn');
  const scene3NextBtn = document.getElementById('scene3NextBtn');
  const scene4NextBtn = document.getElementById('scene4NextBtn');
  const scene5NextBtn = document.getElementById('scene5NextBtn');

  function showMainMenu() {
    mainMenu.classList.remove('hidden');
    animationPage.classList.add('hidden');
    quizPage.classList.add('hidden');
  }
  function showAnimationPage() {
    mainMenu.classList.add('hidden');
    animationPage.classList.remove('hidden');
    quizPage.classList.add('hidden');
    startScenePlay();
  }
  function showQuizPage() {
    mainMenu.classList.add('hidden');
    animationPage.classList.add('hidden');
    quizPage.classList.remove('hidden');
    quizResult.textContent = "";
    leaderboardArea.textContent = "";
  }

  btnGoAnimation.addEventListener('click', showAnimationPage);
  btnGoQuiz.addEventListener('click', showQuizPage);
  btnBackMenuFromAnimation.addEventListener('click', showMainMenu);
  btnBackMenuFromQuiz.addEventListener('click', showMainMenu);

  /* 问答游戏提交 */
  quizSubmitBtn.addEventListener('click', () => {
    const questions = document.querySelectorAll('.quiz-question');
    let correctCount = 0;
    let totalCount = questions.length;
    questions.forEach(q => {
      const correctAnswer = q.getAttribute('data-answer');
      const inputs = q.querySelectorAll('input[type="radio"]');
      let userAnswer = null;
      inputs.forEach(ip => {
        if(ip.checked) {
          userAnswer = ip.value;
        }
      });
      if(userAnswer === correctAnswer) {
        correctCount++;
      }
    });

    quizResult.textContent = `本次答对：${correctCount} / ${totalCount} 题`;
    const teacherScores = [
      { name: '杨金老师', score: totalCount }, 
      { name: '辛宇老师', score: totalCount-1 },
      { name: '胡明波老师', score: Math.max(1, totalCount-1) },
    ];
    let rankingText = `<p>排行榜(与老师对比)：</p><ul style="list-style:none;padding:0;">`;
    rankingText += `<li>你：${correctCount} / ${totalCount}</li>`;
    teacherScores.forEach(ts => {
      rankingText += `<li>${ts.name}：${ts.score} / ${totalCount}</li>`;
    });
    rankingText += `</ul>`;
    leaderboardArea.innerHTML = rankingText;
  });

  /* 动画场景切换 */
  function showScene(idx) {
    scenes.forEach(s => s.classList.remove('active'));
    scenes[idx].classList.add('active');
  }
  function fadeTransition(fromIndex, toIndex) {
    scenes[fromIndex].classList.add('fade-out');
    setTimeout(() => {
      scenes[fromIndex].classList.remove('active','fade-out');
      showScene(toIndex);
      scenes[toIndex].classList.add('fade-in');
      setTimeout(() => {
        scenes[toIndex].classList.remove('fade-in');
      }, 1500);
    }, 1500);
  }

  function skipToNextScene() {
    if(currentSceneIndex < scenes.length - 1) {
      clearTimeout(sceneTimers[currentSceneIndex]);
      fadeTransition(currentSceneIndex, currentSceneIndex+1);
      currentSceneIndex++;
      if(currentSceneIndex === 3) {
        initGame(); // 场景4启动水闸小游戏
      }
      if(currentSceneIndex === 4) {
        // 场景5停留30秒->场景6
        sceneTimers[4] = setTimeout(() => {
          fadeTransition(4,5);
          currentSceneIndex=5;
        },30000);
      }
    }
  }

  scene1NextBtn.addEventListener('click', skipToNextScene);
  scene2NextBtn.addEventListener('click', skipToNextScene);
  scene3NextBtn.addEventListener('click', skipToNextScene);
  scene4NextBtn.addEventListener('click', skipToNextScene);
  scene5NextBtn.addEventListener('click', skipToNextScene);

  function goToScene5() {
    fadeTransition(3,4);
    currentSceneIndex=4;
    sceneTimers[4] = setTimeout(()=>{
      fadeTransition(4,5);
      currentSceneIndex=5;
    },30000);
  }

  function startScenePlay() {
    sceneTimers.forEach(t=>clearTimeout(t));
    sceneTimers=[];
    currentSceneIndex=0;
    showScene(0);

    // 场景1->30秒->2
    sceneTimers[0]=setTimeout(()=>{
      fadeTransition(0,1);
      currentSceneIndex=1;
    },30000);

    // 场景2->30秒->3
    sceneTimers[1]=setTimeout(()=>{
      fadeTransition(1,2);
      currentSceneIndex=2;
    },60000);

    // 场景3->30秒->4
    sceneTimers[2]=setTimeout(()=>{
      fadeTransition(2,3);
      currentSceneIndex=3;
      initGame();
    },90000);
  }

  /* 场景4小游戏 */
  let timeElapsed=0, timerInterval=null, stepCount=0, isGameOver=false;
  let waterLowered=false, boatInChamber=false, waterRaised=false, boatOut=false;

  const valveTop=document.getElementById('valveTop');
  const valveBottom=document.getElementById('valveBottom');
  const gateLeft=document.getElementById('gateLeft');
  const gateRight=document.getElementById('gateRight');
  const chamberWater=document.getElementById('chamberWater');
  const lockBoat=document.getElementById('lockBoat');

  const openTopValveBtn=document.getElementById('openTopValve');
  const closeTopValveBtn=document.getElementById('closeTopValve');
  const openBottomValveBtn=document.getElementById('openBottomValve');
  const closeBottomValveBtn=document.getElementById('closeBottomValve');
  const openLeftGateBtn=document.getElementById('openLeftGate');
  const closeLeftGateBtn=document.getElementById('closeLeftGate');
  const openRightGateBtn=document.getElementById('openRightGate');
  const closeRightGateBtn=document.getElementById('closeRightGate');
  const resetGameBtn=document.getElementById('resetGame');

  const timerText=document.getElementById('timerText');
  const stepsText=document.getElementById('stepsText');
  const gameStatus=document.getElementById('gameStatus');

  const gameHelpOverlay=document.getElementById('gameHelpOverlay');
  const btnShowGameHelp=document.getElementById('btnShowGameHelp');
  const btnCloseHelp=document.getElementById('btnCloseHelp');

  btnShowGameHelp.addEventListener('click',()=>{
    gameHelpOverlay.style.display='block';
  });
  btnCloseHelp.addEventListener('click',()=>{
    gameHelpOverlay.style.display='none';
  });

  function disableAllGameBtns(ms=1500){
    [
      openTopValveBtn,closeTopValveBtn,openBottomValveBtn,closeBottomValveBtn,
      openLeftGateBtn,closeLeftGateBtn,openRightGateBtn,closeRightGateBtn
    ].forEach(btn=>{
      btn.disabled=true;
      setTimeout(()=>{ btn.disabled=false; },ms);
    });
  }

  function initGame(){
    timeElapsed=0; stepCount=0; isGameOver=false;
    waterLowered=false; boatInChamber=false; waterRaised=false; boatOut=false;

    valveTop.classList.remove('open');
    valveBottom.classList.remove('open');
    gateLeft.classList.remove('open-left');
    gateRight.classList.remove('open-right');

    chamberWater.style.height='80%';
    lockBoat.style.left='-8%'; 
    lockBoat.style.bottom='10%';

    timerText.textContent='0';
    stepsText.textContent='0';
    gameStatus.textContent='等待操作';

    if(timerInterval) clearInterval(timerInterval);
    timerInterval=setInterval(()=>{
      if(!isGameOver){
        timeElapsed++;
        timerText.textContent=timeElapsed.toString();
      }
    },1000);
  }

  function addStep(){
    if(!isGameOver){
      stepCount++;
      stepsText.textContent=stepCount.toString();
    }
  }

  function failAction(msg){
    if(!isGameOver){
      isGameOver=true;
      gameStatus.textContent='操作错误：'+msg;
      clearInterval(timerInterval);
      alert('操作错误！'+msg+'\n请点击“重新开始”重试。');
    }
  }

  function checkWin(){
    if(boatOut && !isGameOver){
      isGameOver=true;
      gameStatus.textContent=`通关！耗时${timeElapsed}s，操作${stepCount}次`;
      clearInterval(timerInterval);
      alert(`恭喜你完成水闸操作！\n耗时：${timeElapsed}秒\n操作：${stepCount}次\n可等待自动跳转或点击“进入下一部分”`);
    }
  }

  /* 游戏按钮事件 */
  openTopValveBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(boatInChamber){
      failAction('船在闸室里，不能再开上阀排水。');
      return;
    }
    valveTop.classList.add('open');
    gameStatus.textContent='上阀已开启，水位下降中...';
    chamberWater.style.height='40%';
  });
  closeTopValveBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!valveTop.classList.contains('open')){
      failAction('上阀未开启，无法关闭！');
      return;
    }
    const hVal=parseInt(chamberWater.style.height);
    if(hVal>45){
      failAction('水位尚未降到约40%，就关闭上阀？');
      return;
    }
    valveTop.classList.remove('open');
    waterLowered=true;
    gameStatus.textContent='上阀已关闭，水位保持低位(40%)。';
  });
  openLeftGateBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!waterLowered){
      failAction('还没将水位降到下游水平，就想打开上闸门？');
      return;
    }
    if(boatInChamber){
      failAction('船已在闸室，无需再开上闸门。');
      return;
    }
    gateLeft.classList.add('open-left');
    gameStatus.textContent='上闸门已打开，船正在进入...';
    setTimeout(()=>{
      lockBoat.style.left='35%';
      setTimeout(()=>{ boatInChamber=true; },1500);
    },100);
  });
  closeLeftGateBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!gateLeft.classList.contains('open-left')){
      failAction('上闸门未打开，无法关闭。');
      return;
    }
    if(!boatInChamber){
      failAction('船尚未进入闸室就关闭闸门？');
      return;
    }
    gateLeft.classList.remove('open-left');
    gameStatus.textContent='上闸门已关闭。';
  });
  openBottomValveBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!boatInChamber){
      failAction('船还没进闸室，就开启下阀？');
      return;
    }
    if(valveBottom.classList.contains('open')){
      failAction('下阀已是开启状态。');
      return;
    }
    valveBottom.classList.add('open');
    chamberWater.style.height='80%';
    gameStatus.textContent='下阀已开启，水位升回上游高度...';
  });
  closeBottomValveBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!valveBottom.classList.contains('open')){
      failAction('下阀并未开启，无法关闭。');
      return;
    }
    const hVal=parseInt(chamberWater.style.height);
    if(hVal<75){
      failAction('水位尚未升到80%，就关闭下阀？');
      return;
    }
    valveBottom.classList.remove('open');
    waterRaised=true;
    gameStatus.textContent='下阀已关闭，上游水位保持(80%)。';
  });
  openRightGateBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!waterRaised){
      failAction('还没把水位升回高位，就打开下闸门？');
      return;
    }
    gateRight.classList.add('open-right');
    gameStatus.textContent='下闸门已打开，船驶出...';
    setTimeout(()=>{
      lockBoat.style.left='110%';
      setTimeout(()=>{
        boatOut=true;
        checkWin();
      },1500);
    },100);
  });
  closeRightGateBtn.addEventListener('click',()=>{
    if(isGameOver) return;
    addStep(); disableAllGameBtns();
    if(!gateRight.classList.contains('open-right')){
      failAction('下闸门未打开，无法关闭。');
      return;
    }
    if(!boatOut){
      failAction('船尚未离开，就要关闭下闸门？');
      return;
    }
    gateRight.classList.remove('open-right');
    gameStatus.textContent='下闸门已关闭。';
  });
  resetGameBtn.addEventListener('click',()=>{ initGame(); });

  // 默认显示主菜单
  showMainMenu();
</script>
</body>
</html>
